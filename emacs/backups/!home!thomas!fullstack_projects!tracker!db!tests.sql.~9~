\echo 'Run tests'

\set VERBOSITY terse
\set ON ERROR STOP true

set search_path = data, public;

\echo 'list exercises'
select * from exercises;

\echo 'list recent workout ids/dates'
select * from workouts
order by workout_id desc
limit 10;

\echo 'Develop weekly view on measurements'
select *
from weekly_averages;

\echo 'tonnage per exercise per workout'
select * from workout_tonnage;

\echo 'weekly tonnage per exercise'
select * from weekly_tonnage_exercise;

\echo 'weekly tonnage'
select * from weekly_tonnage;

\echo 'Develop workout insert statement'
with new_workout_id as (
   insert into workouts (workout_name, workout_date)
   values ('workout 3', '2021-12-13') returning workout_id
), new_workout_stages as (
   insert into workout_stages (workout_stage_number, workout_id)
   -- add each stage of the workout
   values   (1, (select * from new_workout_id))
   	  , (2, (select * from new_workout_id))
   returning workout_stage_id, workout_stage_number
)
insert into sets (set_number, set_exercise, set_weight, set_reps, workout_stage_id)
   -- add sets to each workout
   values (1, 1, 10, 10, (select workout_stage_id from new_workout_stages where workout_stage_number=1)),
   	  (2, 1, 15, 20, (select workout_stage_id from new_workout_stages where workout_stage_number=1));
-- select * from new_workout_stages;
select * from sets
order by set_id desc;
